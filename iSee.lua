ores = {}
ores["Adamantite Deposit"] = "Interface\\ICONS\\INV_Ore_Adamantium"
ores["Blackrock Deposit"] = "Interface\\ICONS\\INV_Ore_Blackrock_Ore"
ores["Trillium Vein"] = "Interface\\ICONS\\INV_Ore_BlackTrilliumNugget"
ores["Cobalt Deposit"] = "Interface\\ICONS\\INV_Ore_Cobalt"
ores["Elementium Vein"] = "Interface\\ICONS\\INV_Ore_Elementium_Nugget"
ores["Fel Iron Deposit"] = "Interface\\ICONS\\INV_Ore_FelIron"
ores["Gold Vein"] = "Interface\\ICONS\\INV_Ore_Gold_01"
ores["Copper Vein"] = "Interface\\ICONS\\INV_Ore_Copper_01"
ores["Mithril Deposit"] = "Interface\\ICONS\\INV_Ore_Mithril_01"
ores["Iron Deposit"] = "Interface\\ICONS\\INV_Ore_Iron_01"
ores["Khorium Vein"] = "Interface\\ICONS\\INV_Ore_Khorium"
ores["Mithril Deposit"] = "Interface\\ICONS\\INV_Ore_Mithril_01"
ores["Obsidium Deposit"] = "Interface\\ICONS\\INV_Ore_Obsidium_Nugget"
ores["Pyrite Deposit"] = "Interface\\ICONS\\INV_Ore_Pyrite_Nugget"
ores["Saronite Deposit"] = "Interface\\ICONS\\INV_Ore_Saronite_01"
ores["Silver Vein"] = "Interface\\ICONS\\INV_Ore_Silver_Nugget"
ores["Thorium Vein"] = "Interface\\ICONS\\INV_Ore_Thorium_01"
ores["Tin Vein"] = "Interface\\ICONS\\INV_Ore_Tin_01"
ores["Titanium Vein"] = "Interface\\ICONS\\INV_Ore_Titanium_Nugget"
ores["Trillium Vein"] = "Interface\\ICONS\\INV_Ore_TrilliumWhite"
ores["True Iron Deposit"] = "Interface\\ICONS\\INV_Ore_TrueIronOre"
ores["Truesilver Deposit"] = "Interface\\ICONS\\INV_Ore_TrueSilver_01"
herbs = {}
herbs["Liferoot"] = "Interface\\ICONS\\INV_Misc_Root_02"
herbs["Kingsblood"] = "Interface\\ICONS\\INV_Misc_Herb_03"
herbs["Swiftthistle"] = "Interface\\ICONS\\INV_Misc_Herb_04"
herbs["Earthroot"] = "Interface\\ICONS\\INV_Misc_Herb_07"
herbs["Khadgar's Whisker"] = "Interface\\ICONS\\INV_Misc_Herb_08"
herbs["Silverleaf"] = "Interface\\ICONS\\INV_Misc_Herb_10"
herbs["Stranglekelp"] = "Interface\\ICONS\\INV_Misc_Herb_11"
herbs["Fadeleaf"] = "Interface\\ICONS\\INV_Misc_Herb_12"
herbs["Arthas' Tears"] = "Interface\\ICONS\\INV_Misc_Herb_13"
herbs["Blindweed"] = "Interface\\ICONS\\INV_Misc_Herb_14"
herbs["Goldthorn"] = "Interface\\ICONS\\INV_Misc_Herb_15"
herbs["Gromsblood"] = "Interface\\ICONS\\INV_Misc_Herb_16"
herbs["Purple Lotus"] = "Interface\\ICONS\\INV_Misc_Herb_17"
herbs["Sungrass"] = "Interface\\ICONS\\INV_Misc_Herb_18"
herbs["Firebloom"] = "Interface\\ICONS\\INV_Misc_Herb_19"
herbs["Adders Tounge"] = "Interface\\ICONS\\INV_Misc_Herb_AddersTounge_Stem"
herbs["Ancient Lichen"] = "Interface\\ICONS\\INV_Misc_Herb_AncientLichenPetal"
herbs["Arrowbloom"] = "Interface\\ICONS\\INV_Misc_Herb_Arrowbloom"
herbs["Azsharas Veil"] = "Interface\\ICONS\\INV_Misc_Herb_AzsharasVeil"
herbs["Black Lotus"] = "Interface\\ICONS\\INV_Misc_Herb_BlackLotus"
herbs["Bruiseweed"] = "Interface\\ICONS\\INV_Misc_Herb_Bruiseweed_Stem"
herbs["Cinderbloom"] = "Interface\\ICONS\\INV_Misc_Herb_Cinderbloom"
herbs["Deadnettle"] = "Interface\\ICONS\\INV_Misc_Herb_Deadnettle_Bramble"
herbs["Dragons Teeth"] = "Interface\\ICONS\\INV_Misc_Herb_DragonsTeeth"
herbs["Dreamfoil"] = "Interface\\ICONS\\INV_Misc_Herb_DreamFoil"
herbs["Dreaming Glory"] = "Interface\\ICONS\\INV_Misc_Herb_Dreamingglory"
herbs["Evergreen Moss"] = "Interface\\ICONS\\INV_Misc_Herb_EvergreenMoss"
herbs["Felblossom"] = "Interface\\ICONS\\INV_Misc_Herb_Felblossom"
herbs["Fel Lotus"] = "Interface\\ICONS\\INV_Misc_Herb_FelLotus"
herbs["Felweed"] = "Interface\\ICONS\\INV_Misc_Herb_Felweed"
herbs["Fireweed"] = "Interface\\ICONS\\INV_Misc_Herb_Fireweed"
herbs["Flamecap"] = "Interface\\ICONS\\INV_Misc_Herb_Flamecap"
herbs["Flytrap"] = "Interface\\ICONS\\INV_Misc_Herb_Flytrap"
herbs["Fools Cap"] = "Interface\\ICONS\\INV_Misc_Herb_FoolsCap"
herbs["Frost Lotus"] = "Interface\\ICONS\\INV_Misc_Herb_FrostLotus"
herbs["Frostweed"] = "Interface\\ICONS\\INV_Misc_Herb_FrostWeed"
herbs["Ghost Mushroom"] = "Interface\\ICONS\\INV_Misc_Herb_GhostMushroomCap"
herbs["Goldclover"] = "Interface\\ICONS\\INV_Misc_Herb_GoldClover"
herbs["Golden Lotus"] = "Interface\\ICONS\\INV_Misc_Herb_GoldenLotus"
herbs["Golden Samsam"] = "Interface\\ICONS\\INV_Misc_Herb_GoldenSamsamLeaf"
herbs["GraveMoss"] = "Interface\\ICONS\\INV_Misc_Herb_GraveMoss"
herbs["Heartblossom"] = "Interface\\ICONS\\INV_Misc_Herb_HeartBlossom"
herbs["Icecap"] = "Interface\\ICONS\\INV_Misc_Herb_IceCap"
herbs["Icethorn"] = "Interface\\ICONS\\INV_Misc_Herb_IceThorn"
herbs["Lichbloom"] = "Interface\\ICONS\\INV_Misc_Herb_Lichbloom_Stalk"
herbs["Mana Thistle"] = "Interface\\ICONS\\INV_Misc_Herb_Manathistle"
herbs["Silversage"] = "Interface\\ICONS\\INV_Misc_Herb_MountainSilverSage"
herbs["Netherbloom"] = "Interface\\ICONS\\INV_Misc_Herb_Netherbloom"
herbs["Nightmareseed"] = "Interface\\ICONS\\INV_Misc_Herb_Nightmareseed"
herbs["Nightmarevine"] = "Interface\\ICONS\\INV_Misc_Herb_Nightmarevine"
herbs["PlagueBloom"] = "Interface\\ICONS\\INV_Misc_Herb_PlagueBloom"
herbs["Ragveil"] = "Interface\\ICONS\\INV_Misc_Herb_Ragveil"
herbs["Rain Poppy"] = "Interface\\ICONS\\INV_Misc_Herb_RainPoppy"
herbs["Sansam Root"] = "Interface\\ICONS\\INV_Misc_Herb_SansamRoot"
herbs["Silkweed"] = "Interface\\ICONS\\INV_Misc_Herb_Silkweed"
herbs["Snow Lily"] = "Interface\\ICONS\\INV_Misc_Herb_SnowLily"
herbs["Sorrowmoss"] = "Interface\\ICONS\\INV_Misc_Herb_SorrowmossLeaf"
herbs["Starflower"] = "Interface\\ICONS\\INV_Misc_Herb_Starflower"
herbs["Stormvine"] = "Interface\\ICONS\\INV_Misc_Herb_Stormvine"
herbs["Talador Orchid"] = "Interface\\ICONS\\INV_Misc_Herb_TaladorOrchid"
herbs["Talandras Rose"] = "Interface\\ICONS\\INV_Misc_Herb_TalandrasRose"
herbs["Terrocone"] = "Interface\\ICONS\\INV_Misc_Herb_Terrocone"
herbs["Tigerlily"] = "Interface\\ICONS\\INV_Misc_Herb_Tigerlily"
herbs["Twilight Jasmine"] = "Interface\\ICONS\\INV_Misc_Herb_TwilightJasmine"
herbs["Whiptail"] = "Interface\\ICONS\\INV_Misc_Herb_Whiptail"
herbs["Whispervine"] = "Interface\\ICONS\\INV_Misc_Herb_Whispervine"
herbs["Wild Steelbloom"] = "Interface\\ICONS\\INV_Misc_Herb_WldSteelBloom_Petal"
herbs["Peacebloom"] = "Interface\\ICONS\\INV_Misc_Flower_02"
herbs["Briarthorn"] = "Interface\\ICONS\\Spell_Nature_Thorns"


function round(num, idp)
   local mult = 10^(idp or 0)
   return math.floor(num * mult + 0.5) / mult
end
function delta(x1, y1, z1, x2, y2, z2)
   local dx = x1 - x2
   local dy = y1 - y2
   local dz = z1 - z2
   result = math.sqrt((dx*dx) + (dy*dy) + (dz*dz))
   return result
end
function drawimg(img, obj)
   local texture = {
      -- REQUIRED!
      texture = img,
      width = 32, height = 32,
      scale = 1 -- how to scale the texture
   }
   local targetX, targetY, targetZ = ObjectPosition(obj)
   l.Texture(texture, targetX, targetY, targetZ + 3)
end
function drawline(target)

   local playerX, playerY, playerZ = ObjectPosition("player")
   local targetX, targetY, targetZ = ObjectPosition(target)
   l.Line(playerX, playerY, playerZ, targetX, targetY, targetZ)
end
function drawtext(text, obj, color)
	if color == "orange" then 
		l.SetColor(242, 175, 29, 255)
	else
		l.SetColor(18, 222, 56, 255)
	end
   local targetX, targetY, targetZ = ObjectPosition(obj)
   local name = ObjectName(obj)
   l.Text(text, "GameFontBlack", targetX, targetY, targetZ + 7)
end
function contains(lst, text)
	for key,val in pairs(lst) do
		if key == text then 
			return true 
		end
	end
	return false
end

function checkbl(object)
	for i = 1, table.getn(blacklist) do
		if blacklist[i] == object then return true end
	end
	return false
end

function addtobl(object)
	table.insert(blacklist, object)
	bltime = GetTime()
end

function clear(list)
   for k in pairs (list) do
      list [k] = nil
   end
end

SLASH_ISEE1, SLASH_ISEE2 = '/isee', '/ic'; -- 3.
function SlashCmdList.ISEE(msg, editbox) -- 4.
	iSee:Show()
end

print("iSee Loaded")
l = LibStub("LibDraw-1.0")
l.SetWidth(1)
interact = true
trackherbs = true
trackores = true
yards = true
blacklist = {}
local newcount
local oldcount
local bltime = GetTime()
l.Sync(function()
	if GetTime() - bltime >= 20 then 
		clear(blacklist)
		bltime = GetTime()
	end

	newcount = ObjectCount()
	--if newcount == oldcount then return end
      for i = 1, ObjectCount() do
         local name = ObjectName(ObjectWithIndex(i))
         local object = ObjectWithIndex(i)
         local px, py, pz = ObjectPosition("player")
         local tx, ty, tz = ObjectPosition(object)
		 local playerstill = UnitMovementFlags(ObjectPointer("player")) == 0 or UnitMovementFlags(ObjectPointer("player")) == 8388608
         if ObjectType(object) == 33 and ObjectExists(object) and not checkbl(object) then 
			if round(delta(px,py,pz,tx,ty,tz),0) <= 6 and playerstill and interact then 
				ObjectInteract(object) 
				addtobl(object)
			end
			if trackherbs and contains(herbs, name)then 
				drawimg(herbs[name], object)
				if yards then 
					drawtext(name .. "\n" .. round(delta(px,py,pz,tx,ty,tz),0) .. " yd", object, "green")
				end
			end
			if trackores and contains(ores, name) then
				drawimg(ores[name], object)
				if yards then 
					drawtext(name .. "\n" .. round(delta(px,py,pz,tx,ty,tz),0) .. " yd", object, "orange")
				end
			end
         end
      end
	  oldcount = newcount
end)
l.Enable(0)
